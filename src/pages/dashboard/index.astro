---
/**
 * Dashboard Overview Page
 *
 * @description
 * Main dashboard page displaying key metrics, charts, and recent activity.
 * Uses sample data from dashboard-data.ts for demonstration purposes.
 *
 * Features:
 * - 4 StatCards showing key metrics (Total Projects, Active Users, Revenue, API Calls)
 * - Line chart showing 7-day project creation trend
 * - Recent activity section with latest project updates
 */
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import StatCard from '@dashboard-ui/StatCard.astro';
import Chart from '@dashboard-ui/Chart.astro';
import Card from '@dashboard-ui/Card.astro';
import { getMetrics, getChartData, getProjects } from '@/lib/dashboard-data';
import { Icon } from 'astro-icon/components';

// Get sample data
const metrics = getMetrics();
const chartData = getChartData();
const projects = getProjects();

// Get recent activity (last 5 updated projects)
const recentActivity = projects
  .sort((a, b) => b.updatedAt.getTime() - a.updatedAt.getTime())
  .slice(0, 5);

// Format date for display
function formatDate(date: Date): string {
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return 'Today';
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return `${diffDays} days ago`;

  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

// Get status badge color
function getStatusColor(status: string): string {
  switch (status) {
    case 'active':
      return 'status-active';
    case 'archived':
      return 'status-archived';
    case 'draft':
      return 'status-draft';
    default:
      return '';
  }
}
---

<DashboardLayout
  title="Dashboard Overview"
  description="View your analytics and metrics"
  breadcrumbs={[{ label: 'Dashboard', href: '/dashboard' }, { label: 'Overview' }]}
>
  <div class="dashboard-overview">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Dashboard Overview</h1>
      <p class="page-description">
        Welcome back! Here's what's happening with your projects today.
      </p>
    </div>

    <!-- Metrics Grid -->
    <div class="metrics-grid">
      {
        metrics.map((metric) => (
          <StatCard
            title={metric.title}
            value={metric.value}
            trend={metric.trend}
            icon={metric.icon}
            description={metric.description}
          />
        ))
      }
    </div>

    <!-- Chart Section -->
    <Card title="Project Activity" description="Projects created over the last 7 days">
      <Chart
        type="area"
        data={chartData}
        height={300}
        ariaLabel="Line chart showing project creation trend over the last 7 days"
      />
    </Card>

    <!-- Recent Activity Section -->
    <Card title="Recent Activity" description="Latest project updates">
      <div class="activity-list">
        {
          recentActivity.map((project) => (
            <div class="activity-item">
              <div class="activity-icon">
                <Icon name="lucide:folder" />
              </div>
              <div class="activity-content">
                <div class="activity-header">
                  <a href={`/dashboard/projects/${project.id}`} class="activity-title">
                    {project.name}
                  </a>
                  <span class:list={['activity-status', getStatusColor(project.status)]}>
                    {project.status}
                  </span>
                </div>
                <p class="activity-description">{project.description}</p>
                <div class="activity-meta">
                  <span class="activity-owner">
                    <Icon name="lucide:user" />
                    {project.owner}
                  </span>
                  <span class="activity-date">
                    <Icon name="lucide:clock" />
                    Updated {formatDate(project.updatedAt)}
                  </span>
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </Card>
  </div>
</DashboardLayout>

<style>
  .dashboard-overview {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* Page Header */
  .page-header {
    margin-bottom: 0.5rem;
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text, #000);
    margin: 0 0 0.5rem 0;
    line-height: 1.2;
  }

  .page-description {
    font-size: 1rem;
    color: var(--color-text-muted, #6b7280);
    margin: 0;
  }

  /* Metrics Grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .metrics-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .metrics-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Activity List */
  .activity-list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .activity-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--color-border, #e5e7eb);
  }

  .activity-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .activity-item:first-child {
    padding-top: 0;
  }

  .activity-icon {
    width: 2.5rem;
    height: 2.5rem;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-background, #f9fafb);
    border-radius: var(--radius-md, 0.5rem);
    color: var(--color-primary, #6366f1);
  }

  .activity-icon :global(svg) {
    width: 1.25rem;
    height: 1.25rem;
  }

  .activity-content {
    flex: 1;
    min-width: 0;
  }

  .activity-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.25rem;
    flex-wrap: wrap;
  }

  .activity-title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--color-text, #000);
    text-decoration: none;
    transition: color 150ms ease;
  }

  .activity-title:hover {
    color: var(--color-primary, #6366f1);
  }

  .activity-status {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.625rem;
    border-radius: var(--radius-full, 9999px);
    text-transform: capitalize;
  }

  .status-active {
    color: var(--color-success, #10b981);
    background: color-mix(in srgb, var(--color-success, #10b981) 10%, transparent);
  }

  .status-archived {
    color: var(--color-text-muted, #6b7280);
    background: color-mix(in srgb, var(--color-text-muted, #6b7280) 10%, transparent);
  }

  .status-draft {
    color: var(--color-warning, #f59e0b);
    background: color-mix(in srgb, var(--color-warning, #f59e0b) 10%, transparent);
  }

  .activity-description {
    font-size: 0.875rem;
    color: var(--color-text-muted, #6b7280);
    margin: 0 0 0.5rem 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .activity-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.8125rem;
    color: var(--color-text-muted, #6b7280);
    flex-wrap: wrap;
  }

  .activity-owner,
  .activity-date {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .activity-owner :global(svg),
  .activity-date :global(svg) {
    width: 0.875rem;
    height: 0.875rem;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .page-title {
      font-size: 1.75rem;
    }

    .page-description {
      font-size: 0.9375rem;
    }

    .activity-item {
      gap: 0.75rem;
    }

    .activity-icon {
      width: 2rem;
      height: 2rem;
    }

    .activity-icon :global(svg) {
      width: 1rem;
      height: 1rem;
    }

    .activity-description {
      white-space: normal;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .activity-icon {
      background: var(--color-background, #111827);
    }

    .activity-item {
      border-bottom-color: var(--color-border, #374151);
    }
  }

  /* Focus visible styles for accessibility */
  .activity-title:focus-visible {
    outline: 2px solid var(--color-primary, #6366f1);
    outline-offset: 2px;
    border-radius: var(--radius-sm, 0.375rem);
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .activity-title {
      transition: none;
    }
  }
</style>
